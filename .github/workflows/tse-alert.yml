name: TSE Review Alert

on:
  issues:
    types: [labeled]

jobs:
  notify_slack:
    if: github.event.label.name == 'tse_review'
    runs-on: ubuntu-latest
    steps:
      - name: Create Slack Payload
        id: slack_payload
        env:
          # Your Group ID (Already correct based on your screenshot)
          GROUP_ID: "S0A12AJGEMU" 
          ISSUE_URL: ${{ github.event.issue.html_url }}
          ISSUE_TITLE: ${{ github.event.issue.title }}
          USER_LOGIN: ${{ github.event.issue.user.login }}
        run: |
          # 1. We assume the title might have special characters, so we escape them for JSON
          # 2. We construct the payload using jq
          
          jq -n \
            --arg group "$GROUP_ID" \
            --arg title "$ISSUE_TITLE" \
            --arg url "$ISSUE_URL" \
            --arg user "$USER_LOGIN" \
            '{
              # ADDED THE LINK SYNTAX HERE: <\($url)|\($title)>
              text: "<!subteam^\($group)> Review Requested: <\($url)|\($title)>",
              blocks: [
                {
                  type: "section",
                  text: {
                    type: "mrkdwn",
                    text: ":rotating_light: *TSE Review Requested* <!subteam^\($group)>"
                  }
                },
                {
                  type: "section",
                  text: {
                    type: "mrkdwn",
                    text: "*<\($url)|\($title)>*\nRequested by: \($user)"
                  }
                }
              ]
            }' > payload.json

      - name: Send Slack Notification
        uses: slackapi/slack-github-action@v1.24.0
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
        with:
          payload-file-path: "./payload.json"
